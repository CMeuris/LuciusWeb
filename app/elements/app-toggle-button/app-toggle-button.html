<!-- Copyright (c) 2014 The Polymer Authors. All rights reserved. -->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-a11y-keys/core-a11y-keys.html">
<link rel="import" href="../../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">

<polymer-element name="app-toggle-button"
  attributes="checked disabled"
  role="button"
  aria-pressed="false"
  tabindex="0">

<template>

  <link rel="stylesheet" href="app-toggle-button.css">

  <core-a11y-keys target="{{}}" keys="space" on-keys-pressed="{{tap}}"></core-a11y-keys>

  <div id="toggleContainer" checked?="{{checked}}" disabled?="{{disabled}}">

    <div id="toggleBar" class="toggle toggle-bar"></div>

    <div id="toggleButton" class="toggle toggle-button">
      <paper-ripple id="ink" class="toggle-ink circle"></paper-ripple>
      <core-icon id="icon" icon="sort"></core-icon>
    </div>

  </div>

</template>

<script>
  Polymer('app-toggle-button', {
    checked: false,
    disabled: false,
    eventDelegates: {
      down: 'downAction',
      up: 'upAction',
      tap: 'tap',
      trackstart: 'trackStart',
      trackx: 'trackx',
      trackend: 'trackEnd'
    },

    downAction: function() {
      var rect = this.$.ink.getBoundingClientRect();
      this.$.ink.downAction({
        x: rect.left + rect.width / 2,
        y: rect.top + rect.height / 2
      });
    },

    upAction: function() {
      this.$.ink.upAction();
    },

    tap: function() {
      if (this.disabled) {
        return;
      }

      this.checked = !this.checked;
      this.fire('change');
    },

    trackStart: function(e) {
      if (this.disabled) {
        return;
      }

      this._w = this.$.toggleBar.offsetWidth / 2;
      e.preventTap();
    },

    trackx: function(e) {
      this._x = Math.min(this._w,
          Math.max(0, this.checked ? this._w + e.dx : e.dx));
      this.$.toggleButton.classList.add('dragging');
      var s =  this.$.toggleButton.style;
      s.webkitTransform = s.transform = 'translate3d(' + this._x + 'px,0,0)';
    },

    trackEnd: function() {
      var s =  this.$.toggleButton.style;
      s.transform = s.webkitTransform = '';
      this.$.toggleButton.classList.remove('dragging');
      var old = this.checked;
      this.checked = Math.abs(this._x) > this._w / 2;
      if (this.checked !== old) {
        this.fire('change');
      }
    },

    checkedChanged: function() {
      this.setAttribute('aria-pressed', Boolean(this.checked));
      this.fire('core-change');
    }
  });
</script>
</polymer-element>
